-- SCHEMA: main

-- DROP SCHEMA IF EXISTS main ;

-- CREATE SCHEMA IF NOT EXISTS main
--     AUTHORIZATION postgres;

-- Инициализация 

DELETE FROM accounting;
DELETE FROM check_list;
DELETE FROM purchase;
DELETE FROM store;
DELETE FROM product;

INSERT INTO store 
		(id, address) 
	VALUES 
		(1, 'LA, 5 Avenue'), 
		(2, 'LA, 11 Avenue'),
		(3, 'LA, 12 Avenue');

INSERT INTO product 
		(article, name, category, quantity_to_assess)
	VALUES 
		(1, 'Колбаса докторская', 'meat', '100g'),
		(2, 'Сырок плавленный', 'milk', 'p'), 
		(3, 'Молоко, бутылка 1л', 'milk', 'p'),
		(4, 'Булочка "Лакомка"', 'bake', 'p'),
		(5, 'Стейк, говяжий', 'meat', 'p'),
		(6, 'Хлеб белый', 'bake', 'p'),
		(7, 'Йогурт клубничный', 'milk', 'p'),
		(8, 'Сосиски', 'meat', '100g'),
		(9, 'Творог 5%', 'milk', 'p'),
		(10, 'Батон нарезной', 'bake', 'p'),
		(11, 'Колбаса сервелат', 'meat', '100g'),
		(12, 'Сыр чеддер', 'milk', 'p'),
		(13, 'Молоко, бутылка 0.5л', 'milk', 'p'),
		(14, 'Булочка "Сдобная"', 'bake', 'p'),
		(15, 'Стейк, свиной', 'meat', 'p'),
		(16, 'Хлеб ржаной', 'bake', 'p'),
		(17, 'Йогурт банановый', 'milk', 'p'),
		(18, 'Колбаса салями', 'meat', '100g'),
		(19, 'Сыр моцарелла', 'milk', 'p'),
		(20, 'Батон французский', 'bake', 'p'),
		(21, 'Колбаса варёная', 'meat', '100g'),
		(22, 'Сыр пармезан', 'milk', 'p'),
		(23, 'Молоко, бутылка 2л', 'milk', 'p'),
		(24, 'Булочка "Слойка"', 'bake', 'p'),
		(25, 'Стейк, куриный', 'meat', 'p'),
		(26, 'Хлеб цельнозерновой', 'bake', 'p'),
		(27, 'Йогурт вишнёвый', 'milk', 'p'),
		(28, 'Колбаса копчёная', 'meat', '100g'),
		(29, 'Сыр гауда', 'milk', 'p'),
		(30, 'Батон с отрубями', 'bake', 'p'),
		(31, 'Колбаса докторская', 'meat', '100g'),
		(32, 'Сырок плавленный', 'milk', 'p'), 
		(33, 'Молоко, бутылка 1л', 'milk', 'p'),
		(34, 'Булочка "Лакомка"', 'bake', 'p'),
		(35, 'Стейк, говяжий', 'meat', 'p'),
		(36, 'Хлеб белый', 'bake', 'p'),
		(37, 'Йогурт клубничный', 'milk', 'p'),
		(38, 'Сосиски', 'meat', '100g'),
		(39, 'Творог 5%', 'milk', 'p'),
		(40, 'Батон нарезной', 'bake', 'p'),
		(41, 'Колбаса сервелат', 'meat', '100g'),
		(42, 'Сыр чеддер', 'milk', 'p'),
		(43, 'Молоко, бутылка 0.5л', 'milk', 'p'),
		(44, 'Булочка "Сдобная"', 'bake', 'p'),
		(45, 'Стейк, свиной', 'meat', 'p'),
		(46, 'Хлеб ржаной', 'bake', 'p'),
		(47, 'Йогурт банановый', 'milk', 'p'),
		(48, 'Колбаса салями', 'meat', '100g'),
		(49, 'Сыр моцарелла', 'milk', 'p'),
		(50, 'Батон французский', 'bake', 'p'),
		(51, 'Колбаса варёная', 'meat', '100g'),
		(52, 'Сыр пармезан', 'milk', 'p'),
		(53, 'Молоко, бутылка 2л', 'milk', 'p'),
		(54, 'Булочка "Слойка"', 'bake', 'p'),
		(55, 'Стейк, куриный', 'meat', 'p'),
		(56, 'Хлеб цельнозерновой', 'bake', 'p'),
		(57, 'Йогурт вишнёвый', 'milk', 'p'),
		(58, 'Колбаса копчёная', 'meat', '100g'),
		(59, 'Сыр гауда', 'milk', 'p'),
		(60, 'Батон с отрубями', 'bake', 'p'),
		(61, 'Колбаса докторская', 'meat', '100g'),
		(62, 'Сырок плавленный', 'milk', 'p'), 
		(63, 'Молоко, бутылка 1л', 'milk', 'p'),
		(64, 'Булочка "Лакомка"', 'bake', 'p'),
		(65, 'Стейк, говяжий', 'meat', 'p'),
		(66, 'Хлеб белый', 'bake', 'p'),
		(67, 'Йогурт клубничный', 'milk', 'p'),
		(68, 'Сосиски', 'meat', '100g'),
		(69, 'Творог 5%', 'milk', 'p'),
		(70, 'Батон нарезной', 'bake', 'p'),
		(71, 'Колбаса сервелат', 'meat', '100g'),
		(72, 'Сыр чеддер', 'milk', 'p'),
		(73, 'Молоко, бутылка 0.5л', 'milk', 'p'),
		(74, 'Булочка "Сдобная"', 'bake', 'p'),
		(75, 'Стейк, свиной', 'meat', 'p'),
		(76, 'Хлеб ржаной', 'bake', 'p'),
		(77, 'Йогурт банановый', 'milk', 'p'),
		(78, 'Колбаса салями', 'meat', '100g'),
		(79, 'Сыр моцарелла', 'milk', 'p'),
		(80, 'Батон французский', 'bake', 'p'),
		(81, 'Колбаса варёная', 'meat', '100g'),
		(82, 'Сыр пармезан', 'milk', 'p'),
		(83, 'Молоко, бутылка 2л', 'milk', 'p'),
		(84, 'Булочка "Слойка"', 'bake', 'p'),
		(85, 'Стейк, куриный', 'meat', 'p'),
		(86, 'Хлеб цельнозерновой', 'bake', 'p'),
		(87, 'Йогурт вишнёвый', 'milk', 'p'),
		(88, 'Колбаса копчёная', 'meat', '100g'),
		(89, 'Сыр гауда', 'milk', 'p'),
		(90, 'Батон с отрубями', 'bake', 'p'),
		(91, 'Колбаса докторская', 'meat', '100g'),
		(92, 'Сырок плавленный', 'milk', 'p'), 
		(93, 'Молоко, бутылка 1л', 'milk', 'p'),
		(94, 'Булочка "Лакомка"', 'bake', 'p'),
		(95, 'Стейк, говяжий', 'meat', 'p'),
		(96, 'Хлеб белый', 'bake', 'p'),
		(97, 'Йогурт клубничный', 'milk', 'p'),
		(98, 'Сосиски', 'meat', '100g'),
		(99, 'Творог 5%', 'milk', 'p'),
		(100, 'Батон нарезной', 'bake', 'p');

INSERT INTO accounting 
		(store_id, product_article, cost, amount)
	VALUES 
		(1, 16, 100, 700),
		(1, 26, 30, 300),
		(1, 36, 70, 300),
		(1, 46, 35, 200),
		(1, 56, 200, 100),
		(2, 12, 190, 700),
		(2, 22, 39, 300),
		(2, 32, 79, 300),
		(2, 42, 39, 200),
		(2, 52, 290, 100),
		(3, 14, 110, 700),
		(3, 24, 40, 300),
		(3, 34, 80, 300),
		(3, 47, 40, 200),
		(3, 57, 210, 100),
		(1, 17, 105, 700),
		(1, 27, 32, 300),
		(1, 37, 72, 300),
		(1, 41, 36, 200),
		(1, 51, 205, 100),
		(2, 11, 195, 700),
		(2, 21, 41, 300),
		(2, 31, 81, 300),
		(2, 40, 41, 200),
		(2, 50, 295, 100),
		(3, 10, 115, 700),
		(3, 20, 42, 300),
		(3, 30, 82, 300),
		(3, 43, 42, 200),
		(3, 53, 215, 100),
		(1, 13, 110, 700),
		(1, 23, 34, 300),
		(1, 33, 74, 300),
		(1, 43, 37, 200),
		(1, 58, 210, 100),
		(2, 18, 200, 700),
		(2, 28, 43, 300),
		(2, 38, 83, 300),
		(2, 48, 43, 200),
		(2, 58, 300, 100),
		(3, 18, 120, 700),
		(3, 29, 44, 300),
		(3, 39, 84, 300),
		(3, 49, 44, 200),
		(3, 59, 220, 100),
		(1, 19, 115, 700),
		(1, 29, 36, 300),
		(1, 39, 76, 300),
		(1, 49, 38, 200),
		(1, 59, 215, 100),
		(2, 15, 205, 700),
		(2, 25, 45, 300),
		(2, 35, 85, 300),
		(2, 45, 45, 200),
		(2, 55, 305, 100),
		(3, 15, 125, 700),
		(3, 21, 46, 300),
		(3, 31, 86, 300),
		(3, 41, 46, 200),
		(3, 51, 225, 100),
		(1, 11, 120, 700),
		(1, 21, 38, 300),
		(1, 37, 78, 300),
		(1, 47, 39, 200),
		(1, 57, 220, 100),
		(2, 11, 210, 700),
		(2, 21, 47, 300),
		(2, 31, 87, 300),
		(2, 41, 47, 200),
		(2, 51, 310, 100),
		(3, 11, 130, 700),
		(3, 21, 48, 300),
		(3, 31, 88, 300),
		(3, 47, 48, 200),
		(3, 57, 230, 100),
		(1, 17, 125, 700),
		(1, 27, 40, 300),
		(1, 37, 80, 300),
		(1, 47, 40, 200),
		(1, 57, 225, 100),
		(2, 17, 215, 700),
		(2, 20, 49, 300),
		(2, 30, 89, 300),
		(2, 40, 49, 200),
		(2, 50, 315, 100),
		(3, 10, 135, 700),
		(3, 20, 50, 300),
		(3, 30, 90, 300),
		(3, 40, 50, 200),
		(3, 50, 235, 100);

-- покупка

-- Вставка 50 чеков с store_id = 1
INSERT INTO check_list 
		(id, store_id, time)
	VALUES 
		(1, 1, now() - interval '8 hour'),
		(2, 1, now() - interval '6 hour'),
		(3, 1, now()),
		(4, 1, now() + interval '1 day'),
		(5, 1, now() + interval '2 day'),
		(6, 1, now() + interval '3 day'),
		(7, 1, now() + interval '4 day'),
		(8, 1, now() + interval '5 day'),
		(9, 1, now() + interval '6 day'),
		(10, 1, now() + interval '7 day'),
		(11, 1, now() + interval '8 day'),
		(12, 1, now() + interval '9 day'),
		(13, 1, now() + interval '10 day'),
		(14, 1, now() + interval '11 day'),
		(15, 1, now() + interval '12 day'),
		(16, 1, now() + interval '13 day'),
		(17, 1, now() + interval '14 day'),
		(18, 1, now() + interval '15 day'),
		(19, 1, now() + interval '16 day'),
		(20, 1, now() + interval '17 day'),
		(21, 1, now() + interval '18 day'),
		(22, 1, now() + interval '19 day'),
		(23, 1, now() + interval '20 day'),
		(24, 1, now() + interval '21 day'),
		(25, 1, now() + interval '22 day'),
		(26, 1, now() + interval '23 day'),
		(27, 1, now() + interval '24 day'),
		(28, 1, now() + interval '25 day'),
		(29, 1, now() + interval '26 day'),
		(30, 1, now() + interval '27 day'),
		(31, 1, now() + interval '28 day'),
		(32, 1, now() + interval '29 day'),
		(33, 1, now() + interval '30 day'),
		(34, 1, now() + interval '31 day'),
		(35, 1, now() + interval '32 day'),
		(36, 1, now() + interval '33 day'),
		(37, 1, now() + interval '34 day'),
		(38, 1, now() + interval '35 day'),
		(39, 1, now() + interval '36 day'),
		(40, 1, now() + interval '37 day'),
		(41, 1, now() + interval '38 day'),
		(42, 1, now() + interval '39 day'),
		(43, 1, now() + interval '40 day'),
		(44, 1, now() + interval '41 day'),
		(45, 1, now() + interval '42 day'),
		(46, 1, now() + interval '43 day'),
		(47, 1, now() + interval '44 day'),
		(48, 1, now() + interval '45 day'),
		(49, 1, now() + interval '46 day'),
		(50, 1, now() + interval '47 day');

-- Вставка покупок для каждого чека
INSERT INTO purchase 
		(check_list_id, product_article, amount)
	VALUES 
		(1, 10, 4.5),
		(1, 11, 10),
		(2, 12, 5.0),
		(2, 13, 8),
		(3, 14, 6.5),
		(3, 15, 7),
		(4, 16, 3.0),
		(4, 17, 9),
		(5, 18, 4.5),
		(5, 19, 10),
		(6, 20, 5.0),
		(6, 21, 8),
		(7, 22, 6.5),
		(7, 23, 7),
		(8, 24, 3.0),
		(8, 25, 9),
		(9, 26, 4.5),
		(9, 27, 10),
		(10, 28, 5.0),
		(10, 29, 8),
		(11, 30, 6.5),
		(11, 31, 7),
		(12, 32, 3.0),
		(12, 33, 9),
		(13, 34, 4.5),
		(13, 35, 10),
		(14, 36, 5.0),
		(14, 37, 8),
		(15, 38, 6.5),
		(15, 39, 7),
		(16, 40, 3.0),
		(16, 41, 9),
		(17, 42, 4.5),
		(17, 43, 10),
		(18, 44, 5.0),
		(18, 45, 8),
		(19, 46, 6.5),
		(19, 47, 7),
		(20, 48, 3.0),
		(20, 49, 9),
		(21, 50, 4.5),
		(21, 51, 10),
		(22, 52, 5.0),
		(22, 53, 8),
		(23, 54, 6.5),
		(23, 55, 7),
		(24, 56, 3.0),
		(24, 57, 9),
		(25, 58, 4.5),
		(25, 10, 10),
		(26, 11, 5.0),
		(26, 12, 8),
		(27, 13, 6.5),
		(27, 14, 7),
		(28, 15, 3.0),
		(28, 16, 9),
		(29, 17, 4.5),
		(29, 18, 10),
		(30, 19, 5.0),
		(30, 20, 8),
		(31, 21, 6.5),
		(31, 22, 7),
		(32, 23, 3.0),
		(32, 24, 9),
		(33, 25, 4.5),
		(33, 26, 10),
		(34, 27, 5.0),
		(34, 28, 8),
		(35, 29, 6.5),
		(35, 30, 7),
		(36, 31, 3.0),
		(36, 32, 9),
		(37, 33, 4.5),
		(37, 34, 10),
		(38, 35, 5.0),
		(38, 36, 8),
		(39, 37, 6.5),
		(39, 38, 7),
		(40, 39, 3.0),
		(40, 40, 9),
		(41, 41, 4.5),
		(41, 42, 10),
		(42, 43, 5.0),
		(42, 44, 8),
		(43, 45, 6.5),
		(43, 46, 7),
		(44, 47, 3.0),
		(44, 48, 9),
		(45, 49, 4.5),
		(45, 50, 10),
		(46, 51, 5.0),
		(46, 52, 8),
		(47, 53, 6.5),
		(47, 54, 7),
		(48, 55, 3.0),
		(48, 56, 9),
		(49, 57, 4.5),
		(49, 58, 10),
		(50, 10, 5.0),
		(50, 11, 8);

	
-- UPDATE accounting
-- 	SET amount=amount-4.5
-- 	WHERE store_id=1 AND product_article=1;

-- UPDATE accounting
-- 	SET amount=amount-10
-- 	WHERE store_id=1 AND product_article=2;

select 
	accounting.store_id,
	accounting.product_article,
	round(purchase.amount*cost,2) as total_cost,
	time
	from check_list 
	inner join purchase 
	on check_list.id=purchase.check_list_id
	inner join accounting
	on purchase.product_article=accounting.product_article
	order by store_id asc, time desc
	;

-- select * from product;

-- select * from accounting;

-- select * from store;
